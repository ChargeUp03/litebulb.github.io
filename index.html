<!DOCTYPE html>
<html>
<head>
    <title>Litebulb</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <style>
        body { font-family: sans-serif; margin: 0; padding: 0; background: #fff; color: #000; }
        .dark { background: #121212; color: #eee; }
        #head { position: fixed; top: 0; width: 100%; background: #eee; border-bottom: 1px solid #ccc; padding: 5px; font-size: 12px; z-index: 10; }
        .dark #head { background: #222; border-color: #444; }

        /* Simplified Chat Area */
        #history { padding: 45px 10px 80px 10px; font-size: 14px; line-height: 1.5; }
        .msg { margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .dark .msg { border-color: #333; }
        .u-lab { font-weight: bold; color: #2196f3; }
        .a-lab { font-weight: bold; color: #4caf50; }

        /* Bottom Bar Fix */
        #bottom { position: fixed; bottom: 0; width: 100%; background: #fff; border-top: 1px solid #ccc; padding: 10px; z-index: 10; white-space: nowrap; }
        .dark #bottom { background: #121212; border-color: #444; }
        
        /* Shorter input box to fit button on same line */
        #p { width: 55%; font-size: 16px; padding: 5px; border: 1px solid #ccc; }
        button { padding: 5px 10px; font-size: 14px; }
    </style>
</head>
<body id="b" class="light">

<div id="head">
    <b>Litebulb</b> | Gemini 3 Flash | 
    <input type="checkbox" onclick="document.getElementById('b').className=(this.checked?'dark':'light')"> Dark
</div>

<div id="history">
    <div class="msg"><span class="a-lab">Gemini:</span> Welcome to Litebulb. How can I help?</div>
</div>

<div id="bottom">
    <input type="file" id="img" accept="image/*" style="display:none" onchange="imgTag()">
    <button onclick="document.getElementById('img').click()">Img</button>
    <input type="text" id="p" placeholder="Type..." onkeypress="if(event.keyCode==13) ask()">
    <button onclick="ask()">Send</button>
    <div id="status" style="font-size:10px; color:gray;"></div>
</div>

<script>
    var currentImg = null;

    function imgTag() {
        var file = document.getElementById('img').files[0];
        var reader = new FileReader();
        reader.onloadend = function() { 
            currentImg = reader.result; 
            document.getElementById('status').innerText = "Image attached."; 
        }
        if(file) reader.readAsDataURL(file);
    }

    function ask() {
        var p = document.getElementById('p');
        var hist = document.getElementById('history');
        var val = p.value;
        if(!val && !currentImg) return;

        // Add user text
        hist.innerHTML += '<div class="msg"><span class="u-lab">User:</span> ' + (currentImg ? '[Image] ' : '') + val + '</div>';
        p.value = "";
        window.scrollTo(0, document.body.scrollHeight);

        var xhr = new XMLHttpRequest();
        // PASTE YOUR URL BELOW
        var scriptUrl = "https://script.google.com/macros/s/AKfycbxiX-LsKNQImETY_t4nqIrlVEBuiZpQ4_mXbNfUWF7Foh31HBLRzJOfmHLcxcBCNVkF/exec"; 
        var cacheBuster = "?t=" + new Date().getTime();
        
        xhr.open("POST", scriptUrl + cacheBuster, true);
        xhr.setRequestHeader("Content-Type", "text/plain");

        xhr.onreadystatechange = function() {
            if (xhr.readyState == 4) {
                var responseText = xhr.responseText || "Error: No response from server.";
                hist.innerHTML += '<div class="msg"><span class="a-lab">Gemini:</span> ' + responseText + '</div>';
                document.getElementById('status').innerText = "";
                currentImg = null;
                window.scrollTo(0, document.body.scrollHeight);
            }
        };

        document.getElementById('status').innerText = "Thinking...";
        xhr.send(JSON.stringify({prompt: val, image: currentImg}));
    }
</script>
</body>
</html>
